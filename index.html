<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì˜ë£Œê´‘ê³  ë²•ê·œ ê²€ì‚¬ | MADMEDCHECK</title>
  <meta name="description" content="AI Vision ê¸°ë°˜ ì˜ë£Œê´‘ê³ ë²• ìœ„ë°˜ ì‚¬ì „ ì ê²€ ë„êµ¬. í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·ì„ ë¶„ì„í•˜ì—¬ ì •í™•í•œ ê²€ì‚¬ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤.">
  
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš–ï¸</text></svg>">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { primary: '#2563eb', 'primary-dark': '#1d4ed8' } } }
    }
  </script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap');
    * { font-family: 'Noto Sans KR', sans-serif; }
    .grade-circle { width: 130px; height: 130px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 800; color: white; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
    .highlight-match { background: linear-gradient(120deg, #fef08a 0%, #fef08a 100%); padding: 2px 6px; border-radius: 4px; font-weight: 600; }
    .highlight-in-context { background: #fee2e2; padding: 1px 3px; border-radius: 2px; color: #dc2626; font-weight: 600; }
    .animate-fade-in { animation: fadeIn 0.5s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .bg-pattern { background-color: #f8fafc; background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e2e8f0' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
    textarea:focus, input:focus { outline: none; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); }
    .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #2563eb; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .context-box { font-size: 0.875rem; line-height: 1.6; background: #f9fafb; border-left: 3px solid #e5e7eb; padding: 12px 16px; border-radius: 0 8px 8px 0; }
    .info-link { color: #2563eb; text-decoration: underline; text-underline-offset: 2px; cursor: pointer; }
    .info-link:hover { color: #1d4ed8; }
    .ai-badge { background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 20px; font-weight: 600; }
    .vision-badge { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; font-size: 0.65rem; padding: 2px 6px; border-radius: 12px; font-weight: 600; }
    .not-violation { background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-left: 4px solid #22c55e; }
    .analysis-progress { background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #3b82f6 100%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    .location-badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 12px; font-weight: 500; }
    .screenshot-container { 
      position: relative; 
      border-radius: 12px; 
      overflow: hidden; 
      background: #f3f4f6; 
      border: 1px solid #e5e7eb;
      width: 100%;
      max-width: 100%;
    }
    .screenshot-container img { 
      width: 100%; 
      height: auto; 
      display: block; 
      min-height: 200px;
      max-height: 400px;
      object-fit: cover;
      object-position: top;
      background: #f9fafb;
    }
    .screenshot-container img.loading {
      background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    .screenshot-placeholder {
      width: 100%;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      color: #6b7280;
      font-size: 0.875rem;
      border-radius: 12px;
      border: 2px dashed #e5e7eb;
    }
    .marker-box { 
      position: absolute; 
      border: 3px solid #ef4444; 
      background: rgba(239, 68, 68, 0.2); 
      border-radius: 4px; 
      animation: pulse-border 2s infinite;
      pointer-events: none;
      min-width: 50px;
      min-height: 20px;
    }
    .marker-box.safe {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.2);
    }
    @keyframes pulse-border { 
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 
      50% { opacity: 0.8; box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.3); } 
    }
    .marker-label { 
      position: absolute; 
      top: -28px; 
      left: 50%;
      transform: translateX(-50%);
      background: #ef4444; 
      color: white; 
      font-size: 0.75rem; 
      padding: 4px 10px; 
      border-radius: 6px; 
      font-weight: 600; 
      white-space: nowrap;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .marker-label.safe {
      background: #22c55e;
    }
    .screenshot-error {
      width: 100%;
      height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #fef2f2;
      color: #991b1b;
      font-size: 0.875rem;
      border-radius: 12px;
    }
  </style>
</head>
<body class="bg-pattern min-h-screen">
  <header class="bg-white shadow-sm border-b sticky top-0 z-50">
    <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center space-x-2 hover:opacity-80 transition-opacity">
        <span class="text-2xl">âš–ï¸</span>
        <span class="font-bold text-xl text-gray-900">MADMEDCHECK</span>
        <span class="ai-badge">AI Vision</span>
      </a>
      <a href="https://madmedcheck.com" target="_blank" class="text-sm text-primary hover:text-primary-dark flex items-center font-medium">
        ì „ì²´ ì„œë¹„ìŠ¤ <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </a>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-8 md:py-12">
    <div class="text-center mb-10">
      <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-4">ì˜ë£Œê´‘ê³  ë²•ê·œ ê²€ì‚¬</h1>
      <p class="text-gray-600 text-lg max-w-2xl mx-auto">
        ë³´ê±´ë³µì§€ë¶€ <span class="font-semibold text-primary">'ê±´ê°•í•œ ì˜ë£Œê´‘ê³  ê°€ì´ë“œë¼ì¸ 2íŒ'</span> ê¸°ë°˜<br>
        <span class="text-gray-500">ğŸ–¼ï¸ AIê°€ í˜ì´ì§€ í™”ë©´ì„ ë³´ê³  ì‹œê°ì  ë§¥ë½ê¹Œì§€ ë¶„ì„í•©ë‹ˆë‹¤</span>
      </p>
    </div>

    <div class="bg-white rounded-2xl shadow-lg border p-6 md:p-8 mb-8">
      <div id="inputUrl" class="input-area">
        <label class="block text-sm font-semibold text-gray-700 mb-3">ê²€ì‚¬í•  í˜ì´ì§€ URL</label>
        <input id="urlInput" type="url" placeholder="https://blog.naver.com/example/123456789" class="w-full p-4 border-2 border-gray-200 rounded-xl text-gray-800 placeholder-gray-400 transition-all"/>
        <div class="mt-3 flex items-start space-x-2 text-sm text-gray-500">
          <span>ğŸ’¡</span>
          <div>
            <p>ë„¤ì´ë²„ ë¸”ë¡œê·¸, ë³‘ì› í™ˆí˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”</p>
            <p class="text-xs text-violet-600 mt-1">ğŸ–¼ï¸ AIê°€ í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·ì„ ë¶„ì„í•˜ì—¬ ë©”ë‰´/ë²„íŠ¼ê³¼ ì‹¤ì œ ê´‘ê³ ë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤</p>
          </div>
        </div>
        <div id="crawlStatus" class="hidden mt-4 p-4 rounded-xl bg-blue-50 border border-blue-200">
          <div class="flex items-center space-x-3">
            <div class="spinner"></div>
            <div>
              <p class="font-medium text-blue-800">í˜ì´ì§€ êµ¬ì¡° ë¶„ì„ ì¤‘...</p>
              <p id="crawlStatusText" class="text-sm text-blue-600">DOM íŠ¸ë¦¬ íƒìƒ‰ ë° ì½˜í…ì¸  ì¶”ì¶œ ì¤‘</p>
            </div>
          </div>
        </div>
        <div id="crawlPreview" class="hidden mt-4 p-4 rounded-xl bg-gray-50 border border-gray-200">
          <div class="flex items-center justify-between mb-3">
            <p class="font-medium text-gray-700">âœ… í˜ì´ì§€ ë¶„ì„ ì™„ë£Œ</p>
            <span id="crawlDuration" class="text-xs text-green-600 font-medium bg-green-50 px-2 py-1 rounded"></span>
          </div>
          <p id="crawlTitle" class="text-sm font-semibold text-gray-800 mb-3"></p>
          
          <!-- ë¶„ì„ ìŠ¤í™ í‘œì‹œ -->
          <div id="crawlStats" class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
            <div class="bg-white rounded-lg p-2 border text-center">
              <p class="text-lg font-bold text-primary" id="statSections">-</p>
              <p class="text-xs text-gray-500">ì„¹ì…˜</p>
            </div>
            <div class="bg-white rounded-lg p-2 border text-center">
              <p class="text-lg font-bold text-primary" id="statLinks">-</p>
              <p class="text-xs text-gray-500">ë§í¬</p>
            </div>
            <div class="bg-white rounded-lg p-2 border text-center">
              <p class="text-lg font-bold text-primary" id="statImages">-</p>
              <p class="text-xs text-gray-500">ì´ë¯¸ì§€</p>
            </div>
            <div class="bg-white rounded-lg p-2 border text-center">
              <p class="text-lg font-bold text-primary" id="statElements">-</p>
              <p class="text-xs text-gray-500">ìš”ì†Œ</p>
            </div>
          </div>
          
          <p id="crawlSummary" class="text-xs text-gray-500 mb-2"></p>
          <div id="crawlTextPreview" class="text-sm text-gray-600 max-h-24 overflow-y-auto bg-white p-3 rounded-lg border"></div>
        </div>
      </div>

      <button id="analyzeBtn" onclick="analyze()" class="w-full mt-6 px-8 py-4 bg-primary text-white rounded-xl font-bold text-lg hover:bg-primary-dark disabled:bg-gray-300 disabled:cursor-not-allowed transition-all transform hover:scale-[1.02] active:scale-[0.98]">check!!</button>
      
      <div id="analysisProgress" class="hidden mt-4">
        <div class="bg-gray-100 rounded-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <span id="progressText" class="text-sm font-medium text-gray-700">ë¶„ì„ ì¤€ë¹„ ì¤‘...</span>
            <span id="progressPercent" class="text-sm text-gray-500">0%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="progressBar" class="analysis-progress h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="resultSection" class="hidden space-y-6 animate-fade-in">
      <div id="sourceInfo" class="hidden bg-blue-50 border border-blue-200 rounded-xl p-4">
        <p class="text-sm text-blue-800">
          <span class="font-semibold">ğŸ”— ë¶„ì„ ëŒ€ìƒ:</span> 
          <a id="sourceUrl" href="#" target="_blank" class="underline hover:text-blue-600"></a>
        </p>
      </div>

      <div id="aiAnalysisBadge" class="hidden bg-gradient-to-r from-violet-50 to-cyan-50 border border-violet-200 rounded-xl p-4">
        <div class="flex items-center space-x-3">
          <span class="text-2xl">ğŸ–¼ï¸</span>
          <div>
            <p class="font-semibold text-violet-800">AI Vision ë¶„ì„ ì™„ë£Œ <span id="visionBadge" class="vision-badge ml-2 hidden">ìŠ¤í¬ë¦°ìƒ· ë¶„ì„ë¨</span></p>
            <p id="aiSummary" class="text-sm text-violet-600"></p>
          </div>
        </div>
      </div>

      <!-- ì ìˆ˜ ì¹´ë“œ -->
      <div class="bg-white rounded-2xl shadow-lg border p-6 md:p-8">
        <div class="flex flex-col md:flex-row items-center justify-between gap-6">
          <div class="text-center md:text-left flex-1">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">ê²€ì‚¬ ê²°ê³¼</h2>
            <p id="resultSummary" class="text-gray-600 text-lg mb-2"></p>
            <div id="resultStats" class="flex flex-wrap gap-3 justify-center md:justify-start mt-4"></div>
          </div>
          <div class="text-center">
            <div id="scoreCircle" class="grade-circle mx-auto"></div>
            <p id="gradeLabel" class="mt-4 font-bold text-xl"></p>
          </div>
        </div>
        
        <div id="scoreBreakdown" class="mt-6 pt-6 border-t border-gray-100">
          <p class="text-sm font-semibold text-gray-700 mb-3">ğŸ“Š ì ìˆ˜ ì‚°ì • ë‚´ì—­</p>
          <div id="scoreDetails" class="space-y-2"></div>
        </div>
      </div>

      <!-- ë¶„ì„ ì œí•œì‚¬í•­ ë¦¬í¬íŠ¸ -->
      <div id="limitationsCard" class="bg-amber-50 rounded-2xl shadow-lg border border-amber-200 p-6 md:p-8 hidden">
        <h3 class="text-xl font-bold text-amber-800 mb-2 flex items-center">
          <span class="text-2xl mr-2">âš ï¸</span> ë¶„ì„ ì‹œ ì°¸ê³ ì‚¬í•­
        </h3>
        <p class="text-amber-700 text-sm mb-4">ì•„ë˜ ì œí•œì‚¬í•­ìœ¼ë¡œ ì¸í•´ ë¶„ì„ ê²°ê³¼ê°€ ë¶€ì •í™•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì¢… í™•ì¸ì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.</p>
        <ul id="limitationsList" class="space-y-2"></ul>
      </div>

      <!-- ìœ„ë°˜ í•­ëª© -->
      <div id="violationsCard" class="bg-white rounded-2xl shadow-lg border p-6 md:p-8 hidden">
        <h3 class="text-xl font-bold text-gray-900 mb-2 flex items-center">
          <span class="text-2xl mr-2">ğŸ’¡</span> í™•ì¸ì´ í•„ìš”í•œ í‘œí˜„
        </h3>
        <p class="text-gray-500 text-sm mb-6">AIê°€ í˜ì´ì§€ í™”ë©´ê³¼ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤</p>
        <div id="violationsList" class="space-y-6"></div>
      </div>

      <!-- ë¬¸ì œì—†ëŠ” í•­ëª© -->
      <div id="safeItemsCard" class="bg-white rounded-2xl shadow-lg border p-6 md:p-8 hidden">
        <h3 class="text-xl font-bold text-gray-900 mb-2 flex items-center">
          <span class="text-2xl mr-2">âœ…</span> ë¬¸ì œì—†ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨ëœ í‘œí˜„
        </h3>
        <p class="text-gray-500 text-sm mb-6">í‚¤ì›Œë“œê°€ ë°œê²¬ëì§€ë§Œ ì‹œê°ì  ë§¥ë½ ë¶„ì„ ê²°ê³¼ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤ (ë©”ë‰´ëª…, ë¡œê·¸ì¸ í•„ìš” ì½˜í…ì¸  ë“±)</p>
        <div id="safeItemsList" class="space-y-4"></div>
      </div>

      <!-- ëˆ„ë½ëœ í•„ìˆ˜ í‘œê¸°ì‚¬í•­ -->
      <div id="disclosuresCard" class="bg-white rounded-2xl shadow-lg border p-6 md:p-8 hidden">
        <h3 class="text-xl font-bold text-gray-900 mb-2 flex items-center"><span class="text-2xl mr-2">ğŸ“‹</span> ì¶”ê°€í•˜ë©´ ì¢‹ì„ í‘œê¸°ì‚¬í•­</h3>
        <p class="text-gray-500 text-sm mb-6">ì´ ë‚´ìš©ë“¤ì„ ì¶”ê°€í•˜ì‹œë©´ ë” ì•ˆì „í•œ ê´‘ê³ ê°€ ë  ìˆ˜ ìˆì–´ìš”</p>
        <ul id="disclosuresList" class="space-y-3"></ul>
      </div>

      <!-- CTA -->
      <div class="bg-gradient-to-br from-primary to-blue-700 rounded-2xl p-8 text-center text-white shadow-lg">
        <h3 class="text-2xl font-bold mb-3">ë” ì •ë°€í•œ ë§ˆì¼€íŒ… ì§„ë‹¨ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
        <p class="text-blue-100 mb-6 text-lg">AEO ë¶„ì„, ë°”ì´ëŸ´ ëª¨ë‹ˆí„°ë§, ê²½ìŸë³‘ì› ë¶„ì„ê¹Œì§€ í•œë²ˆì—!</p>
        <a href="https://madmedcheck.com" target="_blank" class="inline-block px-10 py-4 bg-white text-primary rounded-xl font-bold text-lg hover:bg-blue-50 transition-all transform hover:scale-105 shadow-lg">MADMEDCHECK ë¬´ë£Œ ì²´í—˜ â†’</a>
      </div>

      <div class="bg-gray-100 rounded-xl p-5 text-sm text-gray-500">
        <p class="flex items-start"><span class="mr-2">â„¹ï¸</span>ë³¸ ê²€ì‚¬ëŠ” ë³´ê±´ë³µì§€ë¶€ 'ê±´ê°•í•œ ì˜ë£Œê´‘ê³  ê°€ì´ë“œë¼ì¸ 2íŒ(2024.12)'ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ì°¸ê³ ìš©ìœ¼ë¡œë§Œ í™œìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. ìµœì¢… íŒë‹¨ì€ ê´€í•  ë³´ê±´ì†Œ ë˜ëŠ” ë²•ë¥  ì „ë¬¸ê°€ì™€ ìƒë‹´í•˜ì‹œê¸°ë¥¼ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.</p>
      </div>
    </div>
  </main>

  <footer class="bg-white border-t mt-16">
    <div class="max-w-5xl mx-auto px-4 py-10 text-center">
      <p class="text-gray-600 font-medium mb-2">MADMEDCHECK - í”¼ë¶€Â·ì„±í˜•ì™¸ê³¼ ë§ˆì¼€íŒ… ì§„ë‹¨ í”Œë«í¼</p>
      <p class="text-gray-400 text-sm">Â© 2026 MADMEDCHECK. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // ============================================
    // ë²•ë ¹ ë§í¬ + ì‹¤ì œ ì²˜ë¶„ì‚¬ë¡€ ì¶œì²˜
    // ============================================
    const lawLinks = {
      'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ1í˜¸': 'https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•/ì œ56ì¡°',
      'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ2í˜¸': 'https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•/ì œ56ì¡°',
      'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ3í˜¸': 'https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•/ì œ56ì¡°',
      'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ13í˜¸': 'https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•/ì œ56ì¡°',
      'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ14í˜¸': 'https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•/ì œ56ì¡°',
      'ì˜ë£Œë²• ì œ27ì¡° ì œ3í•­': 'https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•/ì œ27ì¡°',
      'ì˜ë£Œë²• ì œ3ì¡°ì˜5 ì œ1í•­': 'https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•/ì œ3ì¡°ì˜5',
    };
    
    // ì‹¤ì œ ì²˜ë¶„ì‚¬ë¡€ ë°ì´í„° (ì¶œì²˜ ë§í¬ í¬í•¨)
    const penaltyCases = {
      absoluteClaims: {
        case: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ Aí”¼ë¶€ê³¼: "ê°•ë‚¨ ìµœê³  í”¼ë¶€ê³¼" í‘œí˜„ìœ¼ë¡œ ê³¼íƒœë£Œ 200ë§Œì› ë¶€ê³¼ (2023)',
        source: 'https://www.mohw.go.kr/menu.es?mid=a10705010000',
        sourceName: 'ë³´ê±´ë³µì§€ë¶€ í–‰ì •ì²˜ë¶„ ê³µê°œ'
      },
      guaranteeClaims: {
        case: 'ê²½ê¸°ë„ Bì„±í˜•ì™¸ê³¼: "100% ë§Œì¡± ë³´ì¥" ê´‘ê³ ë¡œ ì—…ë¬´ì •ì§€ 15ì¼ + ê³¼íƒœë£Œ 300ë§Œì› (2022)',
        source: 'https://www.mohw.go.kr/menu.es?mid=a10705010000',
        sourceName: 'ë³´ê±´ë³µì§€ë¶€ í–‰ì •ì²˜ë¶„ ê³µê°œ'
      },
      patientTestimonial: {
        case: 'ì„œìš¸ì‹œ Cì˜ì›: ë¸”ë¡œê·¸ì— ì‹œìˆ  ì „í›„ ì‚¬ì§„ ê³µê°œ ê²Œì‹œë¡œ ê³¼íƒœë£Œ 150ë§Œì› (2023)',
        source: 'https://www.kma.org/subMain/medic_ad.asp',
        sourceName: 'ëŒ€í•œì˜ì‚¬í˜‘íšŒ ì˜ë£Œê´‘ê³ ì‹¬ì˜ìœ„ì›íšŒ'
      },
      patientSolicitation: {
        case: 'Dë³‘ì›: í™˜ì ì†Œê°œë¹„ ì§€ê¸‰ìœ¼ë¡œ ë²Œê¸ˆ 2ì²œë§Œì› + ì˜ì‚¬ë©´í—ˆ ìê²©ì •ì§€ 3ê°œì›” (2021)',
        source: 'https://www.mohw.go.kr/menu.es?mid=a10705010000',
        sourceName: 'ë³´ê±´ë³µì§€ë¶€ í–‰ì •ì²˜ë¶„ ê³µê°œ'
      },
      specialtyClaim: {
        case: 'Eì˜ì›: ë¯¸ì§€ì • ìƒíƒœì—ì„œ "í”¼ë¶€ì „ë¬¸ë³‘ì›" ì‚¬ìš©ìœ¼ë¡œ ê³¼íƒœë£Œ 200ë§Œì› (2022)',
        source: 'https://www.mohw.go.kr/menu.es?mid=a10705010000',
        sourceName: 'ë³´ê±´ë³µì§€ë¶€ í–‰ì •ì²˜ë¶„ ê³µê°œ'
      },
      comparisonAd: {
        case: 'Fì˜ì›: "íƒ€ ë³‘ì›ë³´ë‹¤ ì €ë ´" í‘œí˜„ìœ¼ë¡œ ì‹œì •ëª…ë ¹ (2023)',
        source: 'https://www.kma.org/subMain/medic_ad.asp',
        sourceName: 'ëŒ€í•œì˜ì‚¬í˜‘íšŒ ì˜ë£Œê´‘ê³ ì‹¬ì˜ìœ„ì›íšŒ'
      },
      certificationMisuse: {
        case: 'Gë³‘ì›: "ì—°ì˜ˆì¸ OOO ì‹œìˆ  ë³‘ì›" ê´‘ê³ ë¡œ ê³¼íƒœë£Œ 200ë§Œì› (2022)',
        source: 'https://www.mohw.go.kr/menu.es?mid=a10705010000',
        sourceName: 'ë³´ê±´ë³µì§€ë¶€ í–‰ì •ì²˜ë¶„ ê³µê°œ'
      },
      unclearDiscount: {
        case: 'Hì˜ì›: "ìµœëŒ€ 70% í• ì¸" ì¡°ê±´ ë¯¸ê¸°ì¬ë¡œ ì‹œì •ëª…ë ¹ (2023)',
        source: 'https://www.kma.org/subMain/medic_ad.asp',
        sourceName: 'ëŒ€í•œì˜ì‚¬í˜‘íšŒ ì˜ë£Œê´‘ê³ ì‹¬ì˜ìœ„ì›íšŒ'
      },
      unapprovedTech: {
        case: 'Iì˜ì›: ë¯¸í‰ê°€ ì‹œìˆ ì„ "ì‹ ê¸°ìˆ "ë¡œ ê´‘ê³ í•˜ì—¬ ê³¼íƒœë£Œ 300ë§Œì› (2022)',
        source: 'https://www.mohw.go.kr/menu.es?mid=a10705010000',
        sourceName: 'ë³´ê±´ë³µì§€ë¶€ í–‰ì •ì²˜ë¶„ ê³µê°œ'
      }
    };

    // ============================================
    // 1ì°¨ í‚¤ì›Œë“œ íŒ¨í„´
    // ============================================
    const patterns = {
      absoluteClaims: { 
        key: 'absoluteClaims',
        patterns: [/ìµœê³ ì˜?/g,/ìµœìƒì˜?/g,/ìµœì´ˆì˜?/g,/ìœ ì¼í•œ?/g,/ë…ë³´ì /g,/ì„¸ê³„\s*(ìµœê³ |ìµœì´ˆ|ìœ ì¼)/g,/êµ­ë‚´\s*(ìµœê³ |ìµœì´ˆ|ìœ ì¼)/g,/ì•„ì‹œì•„\s*(ìµœê³ |ìµœì´ˆ)/g,/ì—…ê³„\s*(ìµœì´ˆ|ìœ ì¼|ìµœê³ )/g,/No\.?\s*1/gi,/ë„˜ë²„ì›/g,/1ìœ„/g,/1ë“±/g,/ì„ ë‘/g,/ë¦¬ë”©/g,/leading/gi,/top\s*\d*/gi,/ìµœë‹¤\s*(ê²½í—˜|ì‹œìˆ |ìˆ˜ìˆ |ì¼€ì´ìŠ¤)/g,/ì••ë„ì /g,/ë…ì /g,/ìœ ì¼ë¬´ì´/g], 
        severity:'high', 
        category:'ê³¼ì¥ í‘œí˜„',
        icon: 'ğŸ“¢',
        criteria: 'ê°ê´€ì  ê·¼ê±° ì—†ì´ ìµœìƒê¸‰/ì ˆëŒ€ì  í‘œí˜„ ì‚¬ìš©',
        legalBasis:'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ1í˜¸',
        legalText: 'ì˜ë£Œê´‘ê³ ëŠ” ê°ê´€ì ìœ¼ë¡œ ì¸ì •ë˜ì§€ ì•„ë‹ˆí•˜ê±°ë‚˜ ê·¼ê±°ê°€ ì—†ëŠ” ë‚´ìš©ì„ í¬í•¨í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: '1ì°¨ 100ë§Œì› â†’ 2ì°¨ 200ë§Œì› â†’ 3ì°¨ 300ë§Œì›' },
        suggestionBefore: 'ê°•ë‚¨ No.1 í”¼ë¶€ê³¼, ìµœê³ ì˜ ì‹œìˆ ',
        suggestionAfter: 'ê°•ë‚¨ì—­ 3ë²ˆì¶œêµ¬ í”¼ë¶€ê³¼, 10ë…„ ê²½ë ¥ ì „ë¬¸ì˜ ì‹œìˆ ',
        deductionPerMatch: 12
      },
      guaranteeClaims: { 
        key: 'guaranteeClaims',
        patterns: [/100\s*%/g,/ë°±í”„ë¡œ/g,/ë°±í¼ì„¼íŠ¸/g,/ì™„ì¹˜/g,/ì™„ë²½í•œ?\s*(ì¹˜ë£Œ|íš¨ê³¼|ê²°ê³¼)/g,/í™•ì‹¤í•œ?\s*(íš¨ê³¼|ì¹˜ë£Œ|ê²°ê³¼)/g,/ë°˜ë“œì‹œ/g,/ë¬´ì¡°ê±´/g,/ë³´ì¥/g,/guaranteed/gi,/ì•½ì†/g,/ì‹¤íŒ¨\s*(ì—†|ìœ¨\s*0|zero)/gi,/ë¶€ì‘ìš©\s*(ì—†|ìœ¨\s*0|zero)/gi,/ì¬ë°œ\s*(ì—†|ìœ¨\s*0)/g,/í‰ìƒ\s*ë³´ì¥/g], 
        severity:'critical', 
        category:'íš¨ê³¼ ë³´ì¥ í‘œí˜„',
        icon: 'âš ï¸',
        criteria: 'ì¹˜ë£Œ íš¨ê³¼ë¥¼ ë³´ì¥í•˜ê±°ë‚˜ í™•ì‹¤ì‹œí•˜ëŠ” í‘œí˜„',
        legalBasis:'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ1í˜¸',
        legalText: 'ì˜ë£Œê´‘ê³ ëŠ” ê°ê´€ì ìœ¼ë¡œ ì¸ì •ë˜ì§€ ì•„ë‹ˆí•˜ê±°ë‚˜ ê·¼ê±°ê°€ ì—†ëŠ” ë‚´ìš©ì„ í¬í•¨í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜ + í˜•ì‚¬ì²˜ë²Œ ê°€ëŠ¥', detail: 'í—ˆìœ„Â·ê³¼ëŒ€ê´‘ê³  ì‹œ 2ë…„ ì´í•˜ ì§•ì—­ ë˜ëŠ” 2ì²œë§Œì› ì´í•˜ ë²Œê¸ˆ' },
        suggestionBefore: '100% íš¨ê³¼ ë³´ì¥, ì™„ë²½í•œ ê²°ê³¼ ì•½ì†ë“œë¦½ë‹ˆë‹¤',
        suggestionAfter: 'ë†’ì€ ë§Œì¡±ë„ì˜ ì‹œìˆ  (íš¨ê³¼ëŠ” ê°œì¸ì— ë”°ë¼ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤)',
        deductionPerMatch: 20
      },
      patientTestimonial: { 
        key: 'patientTestimonial',
        patterns: [/(ì‹œìˆ |ì¹˜ë£Œ|ìˆ˜ìˆ )\s*í›„ê¸°/g,/ë¦¬ì–¼\s*í›„ê¸°/g,/ì†”ì§\s*í›„ê¸°/g,/ì²´í—˜\s*í›„ê¸°/g,/ì´ìš©\s*í›„ê¸°/g,/ë°©ë¬¸\s*í›„ê¸°/g,/(ì „í›„|ë¹„í¬\s*ì• í”„í„°|before\s*(&|and)?\s*after)/gi,/ì‹œìˆ \s*ì „í›„/g,/ìˆ˜ìˆ \s*ì „í›„/g,/ë³€í™”\s*ì‚¬ì§„/g,/í™˜ì\s*ì¸í„°ë·°/g,/ê³ ê°\s*ì¸í„°ë·°/g,/ì‹¤ì œ\s*(í™˜ì|ì‚¬ë¡€|ì¼€ì´ìŠ¤)/g,/ìƒìƒí•œ?\s*(í›„ê¸°|ë¦¬ë·°)/g], 
        severity:'high', 
        category:'ì¹˜ë£Œê²½í—˜ë‹´',
        icon: 'ğŸ“¸',
        criteria: 'í™˜ì í›„ê¸°, ì „í›„ ì‚¬ì§„ ë“± ì¹˜ë£Œ ê²½í—˜ë‹´ ë…¸ì¶œ',
        legalBasis:'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ2í˜¸',
        legalText: 'ì¹˜ë£Œ íš¨ê³¼ë¥¼ ë³´ì¥í•˜ëŠ” ë“± ì†Œë¹„ìë¥¼ í˜„í˜¹í•  ìš°ë ¤ê°€ ìˆëŠ” ë‚´ìš©ì˜ ê´‘ê³ ë¥¼ í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: '1ì°¨ 100ë§Œì› â†’ 2ì°¨ 200ë§Œì› â†’ 3ì°¨ 300ë§Œì›' },
        suggestionBefore: 'ì‹œìˆ  ì „í›„ ì‚¬ì§„ì„ í™•ì¸í•˜ì„¸ìš”! ìƒìƒí•œ í›„ê¸°',
        suggestionAfter: 'ìƒë‹´ ì‹œ ì‹œìˆ  ê²°ê³¼ë¥¼ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤ (ë¡œê·¸ì¸ íšŒì› ì „ìš©)',
        deductionPerMatch: 12
      },
      patientSolicitation: { 
        key: 'patientSolicitation',
        patterns: [/í˜„ê¸ˆ\s*(ì§€ê¸‰|í™˜ê¸‰|ìºì‹œë°±)/g,/ìºì‹œë°±/g,/ë¦¬ë² ì´íŠ¸/g,/ì†Œê°œë¹„/g,/ì¶”ì²œ\s*ë³´ìƒ/g,/í¬ì¸íŠ¸\s*ì ë¦½/g,/ë¬´ë£Œ\s*(ì‹œìˆ |ìƒë‹´|ì§„ë£Œ)/g,/ê³µì§œ/g,/0ì›/g,/ì „ì•¡\s*ë¬´ë£Œ/g,/(50|60|70|80|90)\s*%\s*(ì´ìƒ)?\s*í• ì¸/g,/ì‚¬ì€í’ˆ/g,/ê²½í’ˆ/g,/ì„ ë¬¼\s*ì¦ì •/g,/ë¬´ë£Œ\s*ì¦ì •/g,/ì¹œêµ¬\s*ì¶”ì²œ/g,/ë¦¬ì›Œë“œ/g], 
        severity:'critical', 
        category:'í™˜ì ìœ ì¸',
        icon: 'ğŸš¨',
        criteria: 'ê¸ˆí’ˆ ì œê³µ, ê³¼ë„í•œ í• ì¸ìœ¼ë¡œ í™˜ì ìœ ì¸',
        legalBasis:'ì˜ë£Œë²• ì œ27ì¡° ì œ3í•­',
        legalText: 'ëˆ„êµ¬ë“ ì§€ ì˜ë¦¬ë¥¼ ëª©ì ìœ¼ë¡œ í™˜ìë¥¼ ì˜ë£Œê¸°ê´€ì´ë‚˜ ì˜ë£Œì¸ì—ê²Œ ì†Œê°œÂ·ì•Œì„ Â·ìœ ì¸í•˜ëŠ” í–‰ìœ„ë¥¼ í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
        penaltyInfo: { level: '3ë…„ ì´í•˜ ì§•ì—­ ë˜ëŠ” 3ì²œë§Œì› ì´í•˜ ë²Œê¸ˆ', detail: 'í˜•ì‚¬ì²˜ë²Œ ëŒ€ìƒ - ì˜ë£Œê¸°ê´€ ê°œì„¤í—ˆê°€ ì·¨ì†Œ ê°€ëŠ¥' },
        suggestionBefore: 'ì¹œêµ¬ ì¶”ì²œí•˜ë©´ ìºì‹œë°± 5ë§Œì›! 50% í• ì¸!',
        suggestionAfter: 'ì‹ ê·œ ë°©ë¬¸ ê³ ê° ìƒë‹´ ë¬´ë£Œ (ë¹„ê¸‰ì—¬ í•­ëª©, ìì„¸í•œ ë‚´ìš©ì€ ë¬¸ì˜)',
        deductionPerMatch: 20
      },
      specialtyClaim: { 
        key: 'specialtyClaim',
        patterns: [/ì „ë¬¸\s*ë³‘ì›/g,/ì „ë¬¸\s*í´ë¦¬ë‹‰/g,/íŠ¹í™”\s*(ë³‘ì›|í´ë¦¬ë‹‰|ì„¼í„°)/g], 
        severity:'high', 
        category:'ì „ë¬¸ë³‘ì› í‘œê¸°',
        icon: 'ğŸ¥',
        criteria: 'ë³´ê±´ë³µì§€ë¶€ ë¯¸ì§€ì • ìƒíƒœì—ì„œ ì „ë¬¸ë³‘ì› ëª…ì¹­ ì‚¬ìš©',
        legalBasis:'ì˜ë£Œë²• ì œ3ì¡°ì˜5 ì œ1í•­',
        legalText: 'ë³´ê±´ë³µì§€ë¶€ì¥ê´€ì€ íŠ¹ì • ì§ˆí™˜ì— ëŒ€í•˜ì—¬ ì „ë¬¸ì ì¸ ì˜ë£Œì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ë³‘ì›ì„ ì „ë¬¸ë³‘ì›ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: 'ë³´ê±´ë³µì§€ë¶€ ì§€ì • ì—†ì´ "ì „ë¬¸ë³‘ì›" ì‚¬ìš© ì‹œ' },
        suggestionBefore: 'í”¼ë¶€ ì „ë¬¸ë³‘ì›, ì„±í˜• ì „ë¬¸ í´ë¦¬ë‹‰',
        suggestionAfter: 'í”¼ë¶€ê³¼ì˜ì›, í”¼ë¶€ê³¼ ì „ë¬¸ì˜ ì§„ë£Œ',
        deductionPerMatch: 12
      },
      comparisonAd: { 
        key: 'comparisonAd',
        patterns: [/íƒ€\s*ë³‘ì›/g,/ë‹¤ë¥¸\s*(ë³‘ì›|ì˜ì›|í´ë¦¬ë‹‰)/g,/ê²½ìŸ\s*(ë³‘ì›|ì˜ì›)/g,/vs/gi,/versus/gi,/(ìš°ë¦¬|ì €í¬)\s*ë³‘ì›(ë§Œ|ì´)/g], 
        severity:'medium', 
        category:'ë¹„êµ í‘œí˜„',
        icon: 'âš–ï¸',
        criteria: 'ê°ê´€ì  ê·¼ê±° ì—†ì´ íƒ€ ì˜ë£Œê¸°ê´€ê³¼ ë¹„êµ',
        legalBasis:'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ1í˜¸',
        legalText: 'ì˜ë£Œê´‘ê³ ëŠ” ê°ê´€ì ìœ¼ë¡œ ì¸ì •ë˜ì§€ ì•„ë‹ˆí•˜ê±°ë‚˜ ê·¼ê±°ê°€ ì—†ëŠ” ë‚´ìš©ì„ í¬í•¨í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: 'ë¹„êµ ëŒ€ìƒ ë° ê·¼ê±° ë¶ˆëª…í™• ì‹œ' },
        suggestionBefore: 'íƒ€ ë³‘ì›ë³´ë‹¤ ë›°ì–´ë‚œ ê¸°ìˆ ë ¥',
        suggestionAfter: '20ë…„ ê²½ë ¥ ì „ë¬¸ì˜ ì§ì ‘ ì‹œìˆ ',
        deductionPerMatch: 6
      },
      certificationMisuse: { 
        key: 'certificationMisuse',
        patterns: [/(ìˆ˜ìƒ|í‘œì°½|ê°ì‚¬ì¥|ê³µë¡œìƒ)/g,/ìœ ëª…ì¸\s*ì¶”ì²œ/g,/ì…€ëŸ½\s*ì¶”ì²œ/g,/ì—°ì˜ˆì¸\s*(ì‹œìˆ |ì¶”ì²œ|ë‹¨ê³¨)/g,/ìŠ¤íƒ€\s*ë³‘ì›/g,/ì¸í”Œë£¨ì–¸ì„œ/g,/ë°©ì†¡\s*ì¶œì—°/g,/TV\s*ì¶œì—°/g], 
        severity:'medium', 
        category:'ì¸ì¦Â·ë³´ì¦ í‘œí˜„',
        icon: 'ğŸ†',
        criteria: 'ê³µì¸ë˜ì§€ ì•Šì€ ì¸ì¦, ìœ ëª…ì¸ ì´ìš© ê´‘ê³ ',
        legalBasis:'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ14í˜¸',
        legalText: 'ì‹¬ì˜ë¥¼ ë°›ì§€ ì•„ë‹ˆí•˜ê±°ë‚˜ ì‹¬ì˜ë°›ì€ ë‚´ìš©ê³¼ ë‹¤ë¥¸ ë‚´ìš©ì˜ ê´‘ê³ ë¥¼ í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: 'ê³µì¸ë˜ì§€ ì•Šì€ ì¸ì¦Â·ë³´ì¦ ì‚¬ìš© ì‹œ' },
        suggestionBefore: 'ì—°ì˜ˆì¸ ë‹¨ê³¨ ë³‘ì›, ë°©ì†¡ ì¶œì—° ì˜ë£Œì§„',
        suggestionAfter: 'ëŒ€í•œí”¼ë¶€ê³¼í•™íšŒ ì •íšŒì›, 00í•™íšŒ ì¸ì¦ì˜',
        deductionPerMatch: 6
      },
      unclearDiscount: { 
        key: 'unclearDiscount',
        patterns: [/ìµœëŒ€\s*\d+\s*%\s*í• ì¸/g,/íŒŒê²©\s*í• ì¸/g,/íŠ¹ê°€/g,/ë¹…ì„¸ì¼/g,/ë•¡ì²˜ë¦¬/g,/í•œì •\s*í• ì¸/g,/ì˜¤ëŠ˜ë§Œ/g,/ë§ˆê°\s*ì„ë°•/g], 
        severity:'medium', 
        category:'í• ì¸ í‘œí˜„',
        icon: 'ğŸ’°',
        criteria: 'í• ì¸ ì¡°ê±´(ëŒ€ìƒ, ê¸°ê°„, ë²”ìœ„)ì´ ë¶ˆëª…í™•í•œ ê´‘ê³ ',
        legalBasis:'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ13í˜¸',
        legalText: 'ì˜ë£Œê´‘ê³ ëŠ” í• ì¸Â·ë¬´ë£Œ ë“±ì„ ê´‘ê³ í•˜ëŠ” ê²½ìš° ê·¸ ë‚´ìš©ì„ ëª…í™•íˆ í‘œì‹œí•˜ì—¬ì•¼ í•œë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: 'í• ì¸ ì¡°ê±´ ë¯¸í‘œì‹œ ì‹œ' },
        suggestionBefore: 'ìµœëŒ€ 50% í• ì¸! ì˜¤ëŠ˜ë§Œ íŠ¹ê°€!',
        suggestionAfter: 'ë ˆì´ì € í† ë‹ 1íšŒ 10ë§Œì› â†’ 8ë§Œì› (1/1~1/31, ì‹ ê·œ íšŒì› í•œì •)',
        deductionPerMatch: 6
      },
      unapprovedTech: { 
        key: 'unapprovedTech',
        patterns: [/ì‹ ê¸°ìˆ /g,/í˜ì‹ \s*ê¸°ìˆ /g,/ìµœì‹ \s*ê¸°ìˆ /g,/ìƒˆë¡œìš´\s*ì¹˜ë£Œë²•/g,/íŠ¹í—ˆ\s*(ì‹œìˆ |ê¸°ìˆ )/g,/ì‹ ê°œë…/g,/ì°¨ì„¸ëŒ€/g], 
        severity:'high', 
        category:'ì‹ ê¸°ìˆ  í‘œí˜„',
        icon: 'ğŸ”¬',
        criteria: 'ì‹ ì˜ë£Œê¸°ìˆ í‰ê°€ë¥¼ ë°›ì§€ ì•Šì€ ê¸°ìˆ  ê´‘ê³ ',
        legalBasis:'ì˜ë£Œë²• ì œ56ì¡° ì œ2í•­ ì œ3í˜¸',
        legalText: 'ì‹ ì˜ë£Œê¸°ìˆ í‰ê°€ë¥¼ ë°›ì§€ ì•„ë‹ˆí•œ ì‹ ì˜ë£Œê¸°ìˆ ì— ê´€í•œ ê´‘ê³ ë¥¼ í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
        penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: 'ì‹ ì˜ë£Œê¸°ìˆ í‰ê°€ìœ„ì›íšŒ í‰ê°€ ì—†ì´ ê´‘ê³  ì‹œ' },
        suggestionBefore: 'ìµœì‹  ì‹ ê¸°ìˆ  ë ˆì´ì €, í˜ì‹ ì  ì¹˜ë£Œë²•',
        suggestionAfter: 'FDA ìŠ¹ì¸ ë ˆì´ì € ì¥ë¹„ ì‚¬ìš©, ê²€ì¦ëœ ì‹œìˆ ë²•',
        deductionPerMatch: 12
      }
    };
    
    const requiredDisclosures = {
      institutionName: { description:'ì˜ë£Œê¸°ê´€ ëª…ì¹­', pattern:/(ë³‘ì›|ì˜ì›|í´ë¦¬ë‹‰|í•œì˜ì›|ì¹˜ê³¼)/g, importance:'critical', deduction: 5, suggestion: 'ì •í™•í•œ ì˜ë£Œê¸°ê´€ëª…ì„ ê¸°ì¬í•´ì£¼ì„¸ìš”' },
      institutionType: { description:'ì˜ë£Œê¸°ê´€ ì¢…ë³„', pattern:/(ì¢…í•©ë³‘ì›|ë³‘ì›|ì˜ì›|í•œì˜ì›|ì¹˜ê³¼ì˜ì›|ì¹˜ê³¼ë³‘ì›)/g, importance:'high', deduction: 3, suggestion: 'ì˜ë£Œê¸°ê´€ ì¢…ë³„ì„ í•¨ê»˜ ê¸°ì¬í•´ì£¼ì„¸ìš”' },
      sideEffects: { description:'ë¶€ì‘ìš© ì•ˆë‚´', pattern:/(ë¶€ì‘ìš©|ì£¼ì˜ì‚¬í•­|ê°œì¸ì°¨|ê°œì¸ì—\s*ë”°ë¼)/g, importance:'high', deduction: 3, suggestion: '"ê°œì¸ì— ë”°ë¼ ë¶€ì‘ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" ë¬¸êµ¬ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”' }
    };

    let originalText = '';
    let analyzedSourceUrl = '';

    // ============================================
    // ìŠ¤í¬ë¦°ìƒ· URL ìƒì„± (Railway Puppeteer API ìš°ì„ )
    // ============================================
    const SCREENSHOT_API = 'https://puppeteer-screenshot-api-production.up.railway.app';
    
    const screenshotServices = [
      // 1ìˆœìœ„: Railway Puppeteer API (íŒì—… ì œê±°ë¨)
      (url) => `${SCREENSHOT_API}/screenshot?url=${encodeURIComponent(url)}&width=1280&height=900&format=image`,
      // 2ìˆœìœ„: WordPress mshots (í´ë°±)
      (url) => `https://s.wordpress.com/mshots/v1/${encodeURIComponent(url)}?w=1280`,
      // 3ìˆœìœ„: thum.io (í´ë°±)
      (url) => `https://image.thum.io/get/width/1280/${encodeURIComponent(url)}`,
    ];
    
    function getScreenshotUrl(url, serviceIndex = 0) {
      if (serviceIndex >= screenshotServices.length) return null;
      return screenshotServices[serviceIndex](url);
    }
    
    // ìŠ¤í¬ë¦°ìƒ· ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë‹¤ìŒ ì„œë¹„ìŠ¤ ì‹œë„
    function handleScreenshotError(img, url) {
      const currentIndex = parseInt(img.dataset.serviceIndex || '0');
      const nextIndex = currentIndex + 1;
      
      if (nextIndex < screenshotServices.length && url) {
        img.dataset.serviceIndex = nextIndex;
        img.src = getScreenshotUrl(url, nextIndex);
        console.log(`Screenshot service ${currentIndex} failed, trying ${nextIndex}`);
      } else {
        // ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤íŒ¨ ì‹œ í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ
        const container = img.parentElement;
        container.innerHTML = `
          <div class="screenshot-placeholder">
            <div class="text-center">
              <span class="text-3xl mb-2 block">ğŸ“·</span>
              <span>ìŠ¤í¬ë¦°ìƒ·ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span><br>
              <a href="${url}" target="_blank" class="text-primary text-sm underline mt-2 inline-block">ì›ë³¸ í˜ì´ì§€ì—ì„œ ì§ì ‘ í™•ì¸ â†’</a>
            </div>
          </div>
        `;
      }
    }

    // ============================================
    // 1ì°¨ ë¶„ì„: í‚¤ì›Œë“œ ë§¤ì¹­
    // ============================================
    function firstPassAnalysis(text) {
      const suspected = [];
      
      for (const [key, cfg] of Object.entries(patterns)) {
        const found = [];
        const contexts = [];
        const uniqueContexts = new Set();
        
        for (const p of cfg.patterns) { 
          const matches = text.match(p); 
          if (matches) {
            found.push(...matches);
            matches.forEach(match => {
              const idx = text.indexOf(match);
              const start = Math.max(0, idx - 50);
              const end = Math.min(text.length, idx + match.length + 50);
              let context = text.substring(start, end);
              if (start > 0) context = '...' + context;
              if (end < text.length) context = context + '...';
              
              const contextKey = context.substring(0, 60);
              if (!uniqueContexts.has(contextKey)) {
                uniqueContexts.add(contextKey);
                contexts.push({ match, context, position: idx });
              }
            });
          }
        }
        
        if (found.length > 0) {
          suspected.push({
            ...cfg,
            matches: [...new Set(found)],
            contexts: contexts,
            count: found.length,
            context: contexts[0]?.context || ''
          });
        }
      }
      
      return suspected;
    }

    // ============================================
    // 2ì°¨ ë¶„ì„: AI Vision ë¶„ì„
    // ============================================
    async function secondPassAnalysis(url, text, suspectedViolations) {
      try {
        const response = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            url,
            text,
            suspectedViolations: suspectedViolations.map(v => ({
              category: v.category,
              matches: v.matches,
              context: v.context,
              criteria: v.criteria
            }))
          })
        });
        
        const data = await response.json();
        
        if (data.fallback || data.error) {
          console.log('AI ë¶„ì„ fallback:', data.error);
          return { 
            analysis: null, 
            hasScreenshot: false, 
            screenshotUrl: null,
            limitations: ['âš ï¸ AI ë¶„ì„ì„ ìˆ˜í–‰í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ì‚¬ ê²°ê³¼ë§Œ í‘œì‹œë©ë‹ˆë‹¤.']
          };
        }
        
        return { 
          analysis: data.analysis, 
          hasScreenshot: data.hasScreenshot,
          screenshotUrl: data.screenshotUrl,
          limitations: data.limitations || []
        };
      } catch (error) {
        console.error('AI ë¶„ì„ ì˜¤ë¥˜:', error);
        return { 
          analysis: null, 
          hasScreenshot: false, 
          screenshotUrl: null,
          limitations: ['âš ï¸ AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message]
        };
      }
    }

    // ============================================
    // ìµœì¢… ê²°ê³¼ ê³„ì‚°
    // ============================================
    function calculateFinalResult(text, suspected, aiResult, sourceUrl) {
      const { analysis: aiAnalysis, hasScreenshot, screenshotUrl, limitations: aiLimitations } = aiResult || {};
      
      // ìŠ¤í¬ë¦°ìƒ· URL: APIì—ì„œ ë°›ê±°ë‚˜, sourceUrlë¡œ ì§ì ‘ ìƒì„± (ì²« ë²ˆì§¸ ì„œë¹„ìŠ¤ ì‚¬ìš©)
      const finalScreenshotUrl = screenshotUrl || (sourceUrl ? getScreenshotUrl(sourceUrl, 0) : null);
      
      // ë¶„ì„ ì œí•œì‚¬í•­ ìˆ˜ì§‘
      const limitations = aiLimitations || [];
      
      const result = {
        score: 100,
        violations: [],
        safeItems: [],
        missingDisclosures: [],
        scoreDeductions: [],
        aiAnalyzed: !!aiAnalysis,
        hasScreenshot: hasScreenshot || !!finalScreenshotUrl,
        screenshotUrl: finalScreenshotUrl,
        aiSummary: aiAnalysis?.summary || '',
        overallAssessment: aiAnalysis?.overallAssessment || '',
        limitations: limitations
      };
      
      if (aiAnalysis && aiAnalysis.results) {
        aiAnalysis.results.forEach((aiResult, idx) => {
          const original = suspected[idx];
          
          // AIê°€ ì§ì ‘ ë°œê²¬í•œ í•­ëª© (í‚¤ì›Œë“œ ë§¤ì¹­ ì—†ì´)
          if (!original) {
            if (aiResult.isViolation) {
              // AIê°€ ìŠ¤í¬ë¦°ìƒ·ì—ì„œ ì§ì ‘ ë°œê²¬í•œ ìœ„ë°˜
              const violation = {
                key: aiResult.category?.toLowerCase().replace(/\s/g, '') || 'aiDetected',
                category: aiResult.category || 'AI ë°œê²¬',
                icon: 'ğŸ–¼ï¸',
                matches: aiResult.matches || [aiResult.category],
                count: 1,
                contexts: [],
                severity: aiResult.confidence === 'high' ? 'high' : 'medium',
                criteria: aiResult.reason,
                legalBasis: 'ì˜ë£Œë²• ì œ56ì¡°',
                legalText: 'ì˜ë£Œê´‘ê³ ëŠ” ê°ê´€ì ìœ¼ë¡œ ì¸ì •ë˜ì§€ ì•„ë‹ˆí•˜ê±°ë‚˜ ê·¼ê±°ê°€ ì—†ëŠ” ë‚´ìš©ì„ í¬í•¨í•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤',
                penaltyInfo: { level: 'ê³¼íƒœë£Œ 300ë§Œì› ì´í•˜', detail: 'ìœ„ë°˜ ì •ë„ì— ë”°ë¼ ìƒì´' },
                aiReason: aiResult.reason,
                aiSuggestion: aiResult.suggestion,
                aiConfidence: aiResult.confidence,
                visualLocation: aiResult.visualLocation,
                requiresLogin: aiResult.requiresLogin,
                elementPath: aiResult.elementPath,
                deduction: 10
              };
              result.violations.push(violation);
              result.score -= 10;
              result.scoreDeductions.push({ category: aiResult.category || 'AI ë°œê²¬', count: 1, deduction: 10 });
            } else if (aiResult.category) {
              // AIê°€ í™•ì¸í–ˆì§€ë§Œ ë¬¸ì œì—†ìŒ
              result.safeItems.push({
                key: 'aiChecked',
                category: aiResult.category || 'AI í™•ì¸',
                icon: 'âœ…',
                matches: aiResult.matches || [],
                aiReason: aiResult.reason,
                visualLocation: aiResult.visualLocation,
                requiresLogin: aiResult.requiresLogin,
                elementPath: aiResult.elementPath
              });
            }
            return;
          }
          
          // ê¸°ì¡´ ë¡œì§: í‚¤ì›Œë“œ ë§¤ì¹­ëœ í•­ëª© ì²˜ë¦¬
          if (aiResult.isViolation) {
            const deduction = Math.min(original.deductionPerMatch * original.count, 45);
            result.violations.push({
              ...original,
              aiReason: aiResult.reason,
              aiSuggestion: aiResult.suggestion,
              aiConfidence: aiResult.confidence,
              visualLocation: aiResult.visualLocation,
              requiresLogin: aiResult.requiresLogin,
              elementPath: aiResult.elementPath,
              deduction
            });
            result.score -= deduction;
            result.scoreDeductions.push({ category: original.category, count: original.count, deduction });
          } else {
            result.safeItems.push({
              ...original,
              aiReason: aiResult.reason,
              visualLocation: aiResult.visualLocation,
              requiresLogin: aiResult.requiresLogin,
              elementPath: aiResult.elementPath
            });
          }
        });
      } else {
        suspected.forEach(v => {
          const deduction = Math.min(v.deductionPerMatch * v.count, 45);
          result.violations.push({ ...v, deduction });
          result.score -= deduction;
          result.scoreDeductions.push({ category: v.category, count: v.count, deduction });
        });
      }
      
      // í…ìŠ¤íŠ¸ê°€ ìˆì„ ë•Œë§Œ í•„ìˆ˜ í‘œê¸°ì‚¬í•­ ì²´í¬
      if (text && text.length > 50) {
        for (const [k, cfg] of Object.entries(requiredDisclosures)) {
          if (!text.match(cfg.pattern)) {
            result.missingDisclosures.push({ ...cfg });
            result.score -= cfg.deduction;
            result.scoreDeductions.push({ category: cfg.description + ' ëˆ„ë½', count: 1, deduction: cfg.deduction });
          }
        }
      }
      
      result.score = Math.max(0, result.score);
      
      if (result.score >= 90) result.grade = { grade: 'A', label: 'ì•ˆì „', color: '#22c55e', emoji: 'ğŸ‰' };
      else if (result.score >= 70) result.grade = { grade: 'B', label: 'ì–‘í˜¸', color: '#84cc16', emoji: 'ğŸ‘' };
      else if (result.score >= 50) result.grade = { grade: 'C', label: 'ì£¼ì˜', color: '#eab308', emoji: 'ğŸ¤”' };
      else if (result.score >= 30) result.grade = { grade: 'D', label: 'ìœ„í—˜', color: '#f97316', emoji: 'ğŸ˜°' };
      else result.grade = { grade: 'F', label: 'ì ê²€í•„ìš”', color: '#ef4444', emoji: 'ğŸš¨' };
      
      const critical = result.violations.filter(v => v.severity === 'critical').length;
      if (result.violations.length === 0 && result.safeItems.length === 0) {
        if (result.aiAnalyzed) {
          result.summary = 'AI Vision ë¶„ì„ ê²°ê³¼ íŠ¹ë³„íˆ ë¬¸ì œë  í‘œí˜„ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ì–´ìš”! ğŸ‰';
        } else {
          result.summary = 'ê²€ì‚¬ ê²°ê³¼ íŠ¹ë³„íˆ ë¬¸ì œë  í‘œí˜„ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ì–´ìš”! ğŸ‰';
        }
      } else if (result.violations.length === 0) {
        result.summary = 'ê²€ì‚¬í•œ í‘œí˜„ë“¤ì€ ëª¨ë‘ ë¬¸ì œì—†ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤! ğŸ‰';
      } else if (critical > 0) {
        result.summary = `í™•ì¸ì´ í•„ìš”í•œ í‘œí˜„ì´ ${result.violations.length}ê°€ì§€ ë°œê²¬ëì–´ìš”`;
      } else {
        result.summary = `${result.violations.length}ê°€ì§€ í‘œí˜„ì„ ê²€í† í•´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”`;
      }
      
      return result;
    }

    // ============================================
    // URL í¬ë¡¤ë§
    // ============================================
    async function crawlUrl(url) {
      const statusEl = document.getElementById('crawlStatus');
      const previewEl = document.getElementById('crawlPreview');
      
      statusEl.classList.remove('hidden');
      document.getElementById('crawlStatusText').textContent = 'URLì—ì„œ ì½˜í…ì¸ ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...';
      previewEl.classList.add('hidden');

      try {
        const response = await fetch('/api/crawl?url=' + encodeURIComponent(url));
        const data = await response.json();

        if (!response.ok || data.error) {
          // í¬ë¡¤ë§ ì‹¤íŒ¨í•´ë„ AI Visionìœ¼ë¡œ ë¶„ì„ ì§„í–‰
          statusEl.classList.add('hidden');
          previewEl.classList.remove('hidden');
          document.getElementById('crawlTitle').textContent = '(í˜ì´ì§€ ì •ë³´)';
          document.getElementById('crawlDuration').textContent = 'í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹¤íŒ¨';
          document.getElementById('statSections').textContent = '-';
          document.getElementById('statLinks').textContent = '-';
          document.getElementById('statImages').textContent = '-';
          document.getElementById('statElements').textContent = '-';
          document.getElementById('crawlSummary').textContent = 'âš ï¸ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹¤íŒ¨ - AI Visionìœ¼ë¡œ ìŠ¤í¬ë¦°ìƒ· ê¸°ë°˜ ë¶„ì„ì„ ì§„í–‰í•©ë‹ˆë‹¤';
          document.getElementById('crawlTextPreview').textContent = 'ì´ í˜ì´ì§€ëŠ” JavaScriptë¡œ ë Œë”ë§ë˜ì–´ í…ìŠ¤íŠ¸ ì¶”ì¶œì´ ì–´ë µìŠµë‹ˆë‹¤. ìŠ¤í¬ë¦°ìƒ· ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.';
          return ''; // ë¹ˆ í…ìŠ¤íŠ¸ ë°˜í™˜, null ëŒ€ì‹ 
        }

        statusEl.classList.add('hidden');
        previewEl.classList.remove('hidden');
        
        document.getElementById('crawlTitle').textContent = data.title || '(ì œëª© ì—†ìŒ)';
        
        // ë¶„ì„ ìŠ¤í™ í‘œì‹œ
        const stats = data.stats || {};
        document.getElementById('crawlDuration').textContent = `${stats.crawlDuration || 0}ì´ˆ ì™„ë£Œ`;
        document.getElementById('statSections').textContent = stats.sections || 0;
        document.getElementById('statLinks').textContent = stats.totalLinks || 0;
        document.getElementById('statImages').textContent = stats.images || 0;
        document.getElementById('statElements').textContent = stats.totalElements || 0;
        
        // ìš”ì•½ ë©”ì‹œì§€
        const summaryParts = [];
        summaryParts.push(`${data.textLength.toLocaleString()}ì í…ìŠ¤íŠ¸`);
        if (stats.navElements) summaryParts.push(`${stats.navElements}ê°œ ë©”ë‰´`);
        if (stats.forms) summaryParts.push(`${stats.forms}ê°œ í¼`);
        if (stats.tables) summaryParts.push(`${stats.tables}ê°œ í…Œì´ë¸”`);
        if (stats.videos) summaryParts.push(`${stats.videos}ê°œ ë™ì˜ìƒ`);
        
        document.getElementById('crawlSummary').textContent = 
          `ğŸ“Š ${stats.sections || 1}ê°œ ì„¹ì…˜, ${stats.totalLinks || 0}ê°œ ë§í¬, ${stats.images || 0}ê°œ ì´ë¯¸ì§€ êµ¬ì¡° ë¶„ì„ ì™„ë£Œ | ${summaryParts.join(' Â· ')}`;
        
        document.getElementById('crawlTextPreview').textContent = 
          data.text.length > 300 ? data.text.substring(0, 300) + '...' : data.text;

        return data.text;

      } catch (error) {
        statusEl.classList.add('hidden');
        alert('í¬ë¡¤ë§ ì‹¤íŒ¨: ' + error.message);
        return null;
      }
    }

    // ============================================
    // UI
    // ============================================
    function updateProgress(text, percent) {
      document.getElementById('progressText').textContent = text;
      document.getElementById('progressPercent').textContent = percent + '%';
      document.getElementById('progressBar').style.width = percent + '%';
    }
    
    function getSeverityStyle(s) {
      return s === 'critical' ? 'border-l-4 border-l-red-400 bg-red-50' :
             s === 'high' ? 'border-l-4 border-l-orange-400 bg-orange-50' :
             s === 'medium' ? 'border-l-4 border-l-yellow-400 bg-yellow-50' :
             'border-l-4 border-l-gray-400 bg-gray-50';
    }
    
    function getSeverityBadge(s) {
      return s === 'critical' ? '<span class="px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700">ğŸ”´ ì¦‰ì‹œ ìˆ˜ì • ê¶Œì¥</span>' :
             s === 'high' ? '<span class="px-3 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700">ğŸŸ  ìˆ˜ì • ê¶Œì¥</span>' :
             s === 'medium' ? '<span class="px-3 py-1 rounded-full text-xs font-bold bg-yellow-100 text-yellow-700">ğŸŸ¡ í™•ì¸ í•„ìš”</span>' :
             '<span class="px-3 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-700">âšª ì°¸ê³ </span>';
    }
    
    function getLocationBadge(loc) {
      if (!loc) return '';
      const colors = {
        'ë©”ë‰´ë°”': 'bg-gray-100 text-gray-600',
        'ë³¸ë¬¸': 'bg-red-100 text-red-700',
        'ë°°ë„ˆ': 'bg-orange-100 text-orange-700',
        'íŒì—…': 'bg-orange-100 text-orange-700',
        'í™•ì¸ë¶ˆê°€': 'bg-gray-100 text-gray-500'
      };
      return `<span class="location-badge ${colors[loc] || 'bg-gray-100 text-gray-600'}">ğŸ“ ${loc}</span>`;
    }
    
    function getLoginBadge(requiresLogin) {
      if (requiresLogin === true) {
        return `<span class="location-badge bg-green-100 text-green-700">ğŸ” ë¡œê·¸ì¸ í•„ìš”</span>`;
      } else if (requiresLogin === false) {
        return `<span class="location-badge bg-red-100 text-red-700">ğŸŒ ê³µê°œ ì½˜í…ì¸ </span>`;
      }
      return '';
    }
    
    function highlightContext(context, matches) {
      let result = context;
      matches.forEach(match => {
        result = result.replace(new RegExp(match.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi'), `<mark class="highlight-in-context">${match}</mark>`);
      });
      return result;
    }

    // ============================================
    // ë©”ì¸ ë¶„ì„ í•¨ìˆ˜
    // ============================================
    async function analyze() {
      const btn = document.getElementById('analyzeBtn');
      const progressEl = document.getElementById('analysisProgress');
      let textToAnalyze = '';
      let urlToAnalyze = '';

      // URL ê²€ì‚¬ë§Œ ì§€ì›
      urlToAnalyze = document.getElementById('urlInput').value.trim();
      if (!urlToAnalyze) {
        alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // URL í˜•ì‹ ê²€ì¦
      if (!urlToAnalyze.startsWith('http://') && !urlToAnalyze.startsWith('https://')) {
        urlToAnalyze = 'https://' + urlToAnalyze;
        document.getElementById('urlInput').value = urlToAnalyze;
      }
      
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner mr-2"></span> êµ¬ì¡° ë¶„ì„ ì¤‘...';
      
      textToAnalyze = await crawlUrl(urlToAnalyze);
      // í¬ë¡¤ë§ ì‹¤íŒ¨í•´ë„ URLì´ ìˆìœ¼ë©´ AI Vision ë¶„ì„ ì§„í–‰
      if (!textToAnalyze) {
        textToAnalyze = ''; // ë¹ˆ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •
      }
      analyzedSourceUrl = urlToAnalyze;

      originalText = textToAnalyze;
      btn.disabled = true;
      progressEl.classList.remove('hidden');
      
      // 1ì°¨: í‚¤ì›Œë“œ ìŠ¤ìº”
      updateProgress('1ì°¨ í‚¤ì›Œë“œ ìŠ¤ìº” ì¤‘...', 20);
      await new Promise(r => setTimeout(r, 300));
      
      const suspected = firstPassAnalysis(textToAnalyze);
      updateProgress(`${suspected.length}ê°œ ì˜ì‹¬ í•­ëª© ë°œê²¬`, 40);
      await new Promise(r => setTimeout(r, 300));
      
      let aiResult = { analysis: null, hasScreenshot: false, screenshotUrl: null };
      
      // URLì´ ìˆìœ¼ë©´ í•­ìƒ AI Vision ë¶„ì„ ì§„í–‰ (í…ìŠ¤íŠ¸ê°€ ì—†ì–´ë„)
      if (urlToAnalyze) {
        // 2ì°¨: AI Vision ë¶„ì„ (URLì´ ìˆì„ ë•Œë§Œ)
        updateProgress('ğŸ–¼ï¸ AIê°€ í˜ì´ì§€ í™”ë©´ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 60);
        aiResult = await secondPassAnalysis(urlToAnalyze, textToAnalyze, suspected);
        updateProgress('ë¶„ì„ ê²°ê³¼ ì •ë¦¬ ì¤‘...', 90);
      } else if (suspected.length > 0) {
        // í…ìŠ¤íŠ¸ë§Œ ìˆì„ ë•Œ
        updateProgress('ğŸ¤– AIê°€ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 60);
        aiResult = await secondPassAnalysis('', textToAnalyze, suspected);
        updateProgress('ë¶„ì„ ê²°ê³¼ ì •ë¦¬ ì¤‘...', 90);
      }
      
      await new Promise(r => setTimeout(r, 200));
      
      const result = calculateFinalResult(textToAnalyze, suspected, aiResult, urlToAnalyze);
      
      updateProgress('ì™„ë£Œ!', 100);
      await new Promise(r => setTimeout(r, 300));
      
      progressEl.classList.add('hidden');
      btn.disabled = false;
      btn.innerHTML = 'check!!';
      
      renderResult(result);
    }

    // ============================================
    // ê²°ê³¼ ë Œë”ë§
    // ============================================
    function renderResult(r) {
      document.getElementById('resultSection').classList.remove('hidden');
      
      const sourceInfo = document.getElementById('sourceInfo');
      if (analyzedSourceUrl) {
        sourceInfo.classList.remove('hidden');
        const sourceUrlEl = document.getElementById('sourceUrl');
        sourceUrlEl.href = analyzedSourceUrl;
        sourceUrlEl.textContent = analyzedSourceUrl.length > 60 ? analyzedSourceUrl.substring(0, 60) + '...' : analyzedSourceUrl;
      } else {
        sourceInfo.classList.add('hidden');
      }

      const aiBadge = document.getElementById('aiAnalysisBadge');
      if (r.aiAnalyzed) {
        aiBadge.classList.remove('hidden');
        document.getElementById('aiSummary').textContent = r.aiSummary || r.overallAssessment || 'AIê°€ ë¬¸ë§¥ì„ ë¶„ì„í•˜ì—¬ ì •í™•ë„ë¥¼ ë†’ì˜€ìŠµë‹ˆë‹¤';
        if (r.hasScreenshot) {
          document.getElementById('visionBadge').classList.remove('hidden');
        }
      } else {
        aiBadge.classList.add('hidden');
      }

      document.getElementById('scoreCircle').style.backgroundColor = r.grade.color;
      document.getElementById('scoreCircle').textContent = r.score;
      document.getElementById('gradeLabel').innerHTML = `${r.grade.grade}ë“±ê¸‰ (${r.grade.label}) ${r.grade.emoji || ''}`;
      document.getElementById('gradeLabel').style.color = r.grade.color;
      document.getElementById('resultSummary').innerHTML = r.summary;
      
      const crit = r.violations.filter(v => v.severity === 'critical').length;
      const high = r.violations.filter(v => v.severity === 'high').length;
      document.getElementById('resultStats').innerHTML = `
        ${crit > 0 ? `<span class="px-3 py-1.5 bg-red-100 text-red-700 rounded-full text-sm font-medium">ì¦‰ì‹œ ìˆ˜ì • ${crit}</span>` : ''}
        ${high > 0 ? `<span class="px-3 py-1.5 bg-orange-100 text-orange-700 rounded-full text-sm font-medium">ìˆ˜ì • ê¶Œì¥ ${high}</span>` : ''}
        ${r.safeItems.length > 0 ? `<span class="px-3 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-medium">ë¬¸ì œì—†ìŒ ${r.safeItems.length}</span>` : ''}
      `;
      
      document.getElementById('scoreDetails').innerHTML = `
        <div class="flex items-center justify-between text-sm py-1">
          <span class="text-gray-600">ê¸°ë³¸ ì ìˆ˜</span>
          <span class="font-medium text-gray-900">100ì </span>
        </div>
        ${r.scoreDeductions.map(d => `
          <div class="flex items-center justify-between text-sm py-1">
            <span class="text-gray-600">${d.category} (${d.count}ê±´)</span>
            <span class="font-medium text-red-600">-${d.deduction}ì </span>
          </div>
        `).join('')}
        <div class="flex items-center justify-between text-sm py-2 border-t border-gray-200 mt-2 pt-2">
          <span class="font-semibold text-gray-900">ìµœì¢… ì ìˆ˜</span>
          <span class="font-bold text-lg" style="color: ${r.grade.color}">${r.score}ì </span>
        </div>
      `;

      // ë¶„ì„ ì œí•œì‚¬í•­ ë¦¬í¬íŠ¸ í‘œì‹œ
      const lc = document.getElementById('limitationsCard');
      const ll = document.getElementById('limitationsList');
      if (r.limitations && r.limitations.length > 0) {
        lc.classList.remove('hidden');
        ll.innerHTML = r.limitations.map(limitation => `
          <li class="flex items-start space-x-2 text-amber-800 bg-amber-100 rounded-lg p-3">
            <span class="text-lg">ğŸ“‹</span>
            <span class="text-sm">${limitation}</span>
          </li>
        `).join('');
      } else {
        lc.classList.add('hidden');
      }

      // ìœ„ë°˜ í•­ëª©
      const vc = document.getElementById('violationsCard');
      const vl = document.getElementById('violationsList');
      if (r.violations.length > 0) {
        vc.classList.remove('hidden');
        vl.innerHTML = r.violations.map((v, idx) => {
          const caseData = penaltyCases[v.key] || {};
          
          // ìŠ¤í¬ë¦°ìƒ· + ìœ„ì¹˜ ì„¤ëª… HTML (ë§ˆí‚¹ ì—†ì´)
          let screenshotHtml = '';
          if (r.screenshotUrl) {
            screenshotHtml = `
              <div class="mb-5">
                <p class="text-sm font-semibold text-gray-700 mb-2">ğŸ“ ë°œê²¬ëœ ìœ„ì¹˜</p>
                ${v.elementPath ? `
                  <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-3">
                    <p class="text-sm text-red-800">
                      <span class="font-semibold">ğŸ¯ ìœ„ì¹˜:</span> ${v.elementPath}
                    </p>
                  </div>
                ` : ''}
                <div class="screenshot-container">
                  <img 
                    src="${r.screenshotUrl}" 
                    alt="í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·" 
                    class="loading"
                    data-service-index="0"
                    data-url="${analyzedSourceUrl.replace(/'/g, "\\'")}"
                    onload="this.classList.remove('loading')"
                    onerror="handleScreenshotError(this, this.dataset.url)"
                  />
                </div>
                ${v.contexts && v.contexts.length > 0 ? `
                  <div class="context-box mt-3">
                    <span class="text-xs text-gray-500 block mb-1">ğŸ“ í…ìŠ¤íŠ¸ì—ì„œ ë°œê²¬:</span>
                    ${highlightContext(v.contexts[0].context, v.matches)}
                  </div>
                ` : ''}
              </div>
            `;
          } else if (v.contexts && v.contexts.length > 0) {
            screenshotHtml = `
              <div class="mb-5">
                <p class="text-sm font-semibold text-gray-700 mb-2">ğŸ“ ë°œê²¬ëœ ìœ„ì¹˜</p>
                ${v.elementPath ? `
                  <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-3">
                    <p class="text-sm text-red-800">
                      <span class="font-semibold">ğŸ¯ ìœ„ì¹˜:</span> ${v.elementPath}
                    </p>
                  </div>
                ` : ''}
                <div class="context-box">${highlightContext(v.contexts[0].context, v.matches)}</div>
              </div>
            `;
          }
          
          return `
          <div class="violation-card rounded-2xl ${getSeverityStyle(v.severity)} overflow-hidden shadow-sm">
            <div class="p-5 md:p-6">
              <div class="flex flex-wrap items-start justify-between gap-3 mb-4">
                <div class="flex items-center flex-wrap gap-2">
                  <span class="text-2xl">${v.icon}</span>
                  <span class="font-bold text-gray-900 text-lg">${v.category}</span>
                  ${getLocationBadge(v.visualLocation)}
                  ${getLoginBadge(v.requiresLogin)}
                </div>
                <div class="flex items-center gap-2">
                  ${getSeverityBadge(v.severity)}
                  <span class="text-sm text-red-600 font-semibold bg-red-50 px-2 py-1 rounded">-${v.deduction}ì </span>
                </div>
              </div>
              
              <div class="mb-4">
                <p class="text-sm font-semibold text-gray-700 mb-2">ğŸ” ë°œê²¬ëœ í‘œí˜„ (${v.count}ê±´)</p>
                <div class="flex flex-wrap gap-2">
                  ${v.matches.map(m => `<span class="highlight-match">${m}</span>`).join('')}
                </div>
              </div>
              
              ${screenshotHtml}
              
              ${v.aiReason ? `
                <div class="bg-violet-50 border border-violet-200 rounded-xl p-4 mb-5">
                  <p class="text-sm font-semibold text-violet-700 mb-1">ğŸ–¼ï¸ AI Vision ë¶„ì„ ê²°ê³¼</p>
                  <p class="text-sm text-violet-800">${v.aiReason}</p>
                  ${v.aiSuggestion ? `<p class="text-sm text-violet-600 mt-2">ğŸ’¡ ${v.aiSuggestion}</p>` : ''}
                </div>
              ` : ''}
              
              <!-- ë²•ë ¹ + ì²˜ë¶„ê¸°ì¤€ + ì²˜ë¶„ì‚¬ë¡€ (ë§í¬ í¬í•¨) -->
              <div class="bg-gray-50 rounded-xl p-4 mb-5">
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <p class="text-xs font-semibold text-gray-500 mb-1">ğŸ“‹ ê´€ë ¨ ë²•ë ¹</p>
                    <a href="${lawLinks[v.legalBasis] || '#'}" target="_blank" class="info-link text-sm font-medium">${v.legalBasis}</a>
                    <p class="text-xs text-gray-500 mt-1 italic">"${v.legalText}"</p>
                  </div>
                  <div>
                    <p class="text-xs font-semibold text-gray-500 mb-1">âš–ï¸ ì²˜ë¶„ ê¸°ì¤€</p>
                    <p class="text-sm font-medium text-gray-800">${v.penaltyInfo.level}</p>
                    <p class="text-xs text-gray-500 mt-1">${v.penaltyInfo.detail}</p>
                  </div>
                </div>
                ${caseData.case ? `
                  <div class="pt-3 border-t border-gray-200">
                    <p class="text-xs font-semibold text-amber-700 mb-1">ğŸ“Œ ì‹¤ì œ ì²˜ë¶„ ì‚¬ë¡€</p>
                    <p class="text-xs text-amber-800 mb-1">${caseData.case}</p>
                    <a href="${caseData.source}" target="_blank" class="text-xs info-link">ğŸ“ ì¶œì²˜: ${caseData.sourceName}</a>
                  </div>
                ` : ''}
              </div>
              
              <!-- ìˆ˜ì • ì œì•ˆ -->
              ${v.suggestionBefore && v.suggestionAfter ? `
                <div>
                  <p class="text-sm font-semibold text-gray-700 mb-3">âœ¨ ìˆ˜ì • ì œì•ˆ</p>
                  <div class="grid md:grid-cols-2 gap-3">
                    <div class="bg-red-50 border border-red-200 p-3 rounded-xl">
                      <p class="text-xs font-semibold text-red-600 mb-1">âŒ ì´ëŸ° í‘œí˜„ì€ ì£¼ì˜</p>
                      <p class="text-sm text-red-700">${v.suggestionBefore}</p>
                    </div>
                    <div class="bg-green-50 border border-green-200 p-3 rounded-xl">
                      <p class="text-xs font-semibold text-green-600 mb-1">âœ… ì´ë ‡ê²Œ ë°”ê¿”ë³´ì„¸ìš”</p>
                      <p class="text-sm text-green-700">${v.suggestionAfter}</p>
                    </div>
                  </div>
                  <p class="text-xs text-gray-400 mt-3 italic">â€» ìˆ˜ì • ì œì•ˆì€ ë²•ë ¹ê³¼ ê°€ì´ë“œë¼ì¸ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì°¸ê³  ì‚¬í•­ì´ë©°, 100% ì ë²•ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                </div>
              ` : ''}
            </div>
          </div>
        `}).join('');
      } else {
        vc.classList.add('hidden');
      }
      
      // ë¬¸ì œì—†ëŠ” í•­ëª©
      const sc = document.getElementById('safeItemsCard');
      const sl = document.getElementById('safeItemsList');
      if (r.safeItems.length > 0) {
        sc.classList.remove('hidden');
        sl.innerHTML = r.safeItems.map((v, idx) => {
          let locationHtml = '';
          if (v.elementPath) {
            locationHtml = `
              <div class="mt-2 bg-green-50 border border-green-200 rounded-lg p-2">
                <p class="text-xs text-green-800">
                  <span class="font-semibold">ğŸ¯ ìœ„ì¹˜:</span> ${v.elementPath}
                </p>
              </div>
            `;
          }
          
          return `
          <div class="not-violation rounded-xl p-4">
            <div class="flex items-start justify-between">
              <div class="flex items-center flex-wrap gap-2">
                <span class="font-semibold text-green-800">${v.icon} ${v.category}</span>
                <span class="text-sm text-green-600">â€” ${v.matches.join(', ')}</span>
                ${getLocationBadge(v.visualLocation)}
                ${getLoginBadge(v.requiresLogin)}
              </div>
              <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">âœ… ë¬¸ì œì—†ìŒ</span>
            </div>
            ${v.aiReason ? `<p class="text-sm text-green-700 mt-2">ğŸ–¼ï¸ ${v.aiReason}</p>` : ''}
            ${locationHtml}
          </div>
        `}).join('');
      } else {
        sc.classList.add('hidden');
      }
      
      // í•„ìˆ˜ í‘œê¸°ì‚¬í•­
      const dc = document.getElementById('disclosuresCard');
      const dl = document.getElementById('disclosuresList');
      if (r.missingDisclosures.length > 0) {
        dc.classList.remove('hidden');
        dl.innerHTML = r.missingDisclosures.map(m => `
          <li class="bg-amber-50 text-amber-800 px-5 py-4 rounded-xl border border-amber-200">
            <div class="flex items-center justify-between mb-2">
              <span class="flex items-center font-medium"><span class="mr-2 text-lg">ğŸ’¡</span>${m.description}</span>
              <span class="text-sm text-red-600 font-medium">-${m.deduction}ì </span>
            </div>
            <p class="text-sm text-amber-700">${m.suggestion}</p>
          </li>
        `).join('');
      } else {
        dc.classList.add('hidden');
      }
      
      document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    document.getElementById('urlInput').addEventListener('keydown', e => { if (e.key === 'Enter') analyze(); });
  </script>
</body>
</html>
